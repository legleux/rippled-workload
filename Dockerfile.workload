FROM ghcr.io/astral-sh/uv:0.8.3-python3.13-bookworm

ENV PYTHONUNBUFFERED=1 \
    PATH="/opt/antithesis/catalog/workload/.venv/bin:/opt/antithesis/test/v1/all_transactions:$PATH"
WORKDIR /opt/antithesis/catalog/workload

RUN apt-get update && apt-get install -y curl vim-tiny jq

COPY workload /opt/antithesis/catalog/workload
COPY test_composer/all_transactions /opt/antithesis/test/v1/all_transactions

RUN uv sync

EXPOSE 8000

CMD ["uvicorn", "workload.app:app", "--host", "0.0.0.0", "--port", "8000"]
